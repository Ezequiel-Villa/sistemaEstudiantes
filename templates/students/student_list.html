{% extends 'base.html' %}
{% block title %}Estudiantes{% endblock %}
{% block content %}
<section class="page-hero">
    <div>
        <p class="muted">Administración</p>
        <h1>Gestión de Estudiantes</h1>
        <p>Administra el registro completo de estudiantes.</p>
    </div>
    <div class="actions-inline">
        <a class="btn btn-ghost" href="{% url 'students:dashboard' %}"><svg class="icon" aria-hidden="true"><use href="#icon-gauge"></use></svg> Dashboard</a>
        <a class="btn btn-primary" href="{% url 'students:student_create' %}"><svg class="icon" aria-hidden="true"><use href="#icon-user-plus"></use></svg> Agregar estudiante</a>
    </div>
</section>

<div class="actions-inline" style="margin-bottom:12px;">
    <a class="btn btn-ghost" href="{% url 'students:export_csv' %}"><svg class="icon" aria-hidden="true"><use href="#icon-download"></use></svg> Exportar CSV</a>
    <a class="btn btn-ghost" href="{% url 'students:export_excel' %}"><svg class="icon" aria-hidden="true"><use href="#icon-save"></use></svg> Exportar Excel</a>
</div>

<div class="surface">
    <form class="form-grid" method="get" style="margin-bottom: 14px;">
        <div class="form-field">
            <label>Buscar por nombre o matrícula</label>
            <input type="text" name="q" value="{{ query }}" class="input-control" placeholder="Ej: Juan" />
        </div>
        <div class="form-field">
            <label>Grupo</label>
            <select name="group" class="input-control">
                <option value="">Todos</option>
                {% for group in groups %}
                    <option value="{{ group }}" {% if group_filter == group %}selected{% endif %}>{{ group }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-field">
            <label>Estado</label>
            <select name="status" class="input-control">
                <option value="">Todos</option>
                <option value="inscrito" {% if status_filter == 'inscrito' %}selected{% endif %}>Inscrito</option>
                <option value="baja_temporal" {% if status_filter == 'baja_temporal' %}selected{% endif %}>Baja temporal</option>
                <option value="baja_definitiva" {% if status_filter == 'baja_definitiva' %}selected{% endif %}>Baja definitiva</option>
                <option value="egresado" {% if status_filter == 'egresado' %}selected{% endif %}>Egresado</option>
            </select>
        </div>
        <div class="form-field" style="align-self:end;">
            <button class="btn btn-primary" type="submit"><svg class="icon" aria-hidden="true"><use href="#icon-filter"></use></svg> Filtrar</button>
        </div>
    </form>

    <div class="table-wrapper">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Matrícula</th>
                    <th>Correo</th>
                    <th>Grupo</th>
                    <th>Carrera</th>
                    <th>Estado</th>
                    <th style="text-align:right;">Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for student in students %}
                    <tr>
                        <td><strong>{{ student.full_name }}</strong></td>
                        <td>{{ student.matricula }}</td>
                        <td>{{ student.email }}</td>
                        <td>{{ student.group }}</td>
                        <td>{{ student.career }}</td>
                        <td>
                            {% if student.status == 'inscrito' %}
                                <span class="badge badge-success">Inscrito</span>
                            {% elif student.status == 'baja_temporal' %}
                                <span class="badge badge-warning">Baja temporal</span>
                            {% elif student.status == 'baja_definitiva' %}
                                <span class="badge badge-danger">Baja definitiva</span>
                            {% else %}
                                <span class="badge badge-info">Egresado</span>
                            {% endif %}
                        </td>
                        <td style="text-align:right;">
                            <div class="table-actions">
                                <a class="btn btn-ghost btn-sm" href="{% url 'students:student_detail' student.pk %}"><svg class="icon" aria-hidden="true"><use href="#icon-eye"></use></svg></a>
                                <a class="btn btn-ghost btn-sm" href="{% url 'students:student_update' student.pk %}"><svg class="icon" aria-hidden="true"><use href="#icon-pencil"></use></svg></a>
                                <a class="btn btn-danger btn-sm" href="{% url 'students:student_delete' student.pk %}"><svg class="icon" aria-hidden="true"><use href="#icon-trash"></use></svg></a>
                            </div>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="7" style="text-align:center; padding: 18px;" class="muted">No se encontraron estudiantes con los filtros actuales.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
